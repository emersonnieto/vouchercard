generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum VoucherStatus {
  ACTIVE
  CANCELED
  USED
}

enum FlightDirection {
  OUTBOUND
  RETURN
}

model Agency {
  id           String   @id @default(uuid())
  name         String
  slug         String   @unique
  phone        String?
  email        String?
  createdAt    DateTime @default(now())
  isActive     Boolean  @default(true)
  logoUrl      String?
  primaryColor String?

  vouchers Voucher[]
  users    User[]
}

model User {
  id           String   @id @default(uuid())
  agencyId     String
  name         String
  email        String   @unique
  passwordHash String
  role         String   @default("ADMIN")
  createdAt    DateTime @default(now())

  agency Agency @relation(fields: [agencyId], references: [id])
}

model Voucher {
  id                String        @id @default(uuid())
  agencyId          String
  reservationCode   String        @unique
  clientName        String
  status            VoucherStatus @default(ACTIVE)
  createdAt         DateTime      @default(now())
  agency            Agency        @relation(fields: [agencyId], references: [id])
  flights           Flight[]
  hotel             Hotel?
  transfer          Transfer?
  stopover          Stopover?
  tours             Tour[]
  travelInsurance   TravelInsurance?
}

model Flight {
  id               String          @id @default(uuid())
  voucherId        String
  direction        FlightDirection @default(OUTBOUND)
  flightNumber     String?
  departureTime    String?
  arrivalTime      String?
  embarkAirport    String?
  disembarkAirport String?

  voucher Voucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)

  @@index([voucherId])
}

model Hotel {
  id           String @id @default(uuid())
  voucherId    String @unique
  hotelName    String
  mealPlan     String?
  roomType     String?
  checkInTime  String?
  checkOutTime String?

  voucher Voucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)
}

model Transfer {
  id            String @id @default(uuid())
  voucherId     String @unique
  receptiveName String?

  voucher Voucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)
}

model Stopover {
  id              String @id @default(uuid())
  voucherId        String @unique
  location         String?
  duration         String?
  additionalNotes  String?

  voucher Voucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)
}

model Tour {
  id              String @id @default(uuid())
  voucherId        String
  name            String
  dateTime        String?
  meetingPoint    String?
  additionalNotes String?

  voucher Voucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)

  @@index([voucherId])
}

model TravelInsurance {
  id              String @id @default(uuid())
  voucherId        String @unique
  providerName    String
  providerPhone   String?
  additionalNotes String?

  voucher Voucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)
}
