generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum VoucherStatus {
  ACTIVE
  CANCELED
  USED
}

enum FlightDirection {
  OUTBOUND
  RETURN
}

model Agency {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  phone     String?
  email     String?
  createdAt DateTime @default(now())

  isActive  Boolean  @default(true) // ✅ NOVO
  logoUrl   String?               // ✅ (já aproveita)
  primaryColor String?            // ✅ opcional

  vouchers  Voucher[]
  users     User[]
}

model User {
  id           String   @id @default(uuid())
  agencyId     String
  name         String
  email        String   @unique
  passwordHash String
  role         String   @default("ADMIN")
  createdAt    DateTime @default(now())

  agency Agency @relation(fields: [agencyId], references: [id])
}

model Voucher {
  id              String        @id @default(uuid())
  agencyId         String
  reservationCode  String        @unique   // ✅ agora é único global
  clientName       String
  status           VoucherStatus @default(ACTIVE)
  createdAt        DateTime      @default(now())

  agency   Agency  @relation(fields: [agencyId], references: [id])
  flights  Flight[]
  hotel    Hotel?
  transfer Transfer?
}

model Flight {
  id             String          @id @default(uuid())
  voucherId       String
  direction       FlightDirection @default(OUTBOUND)
  segmentOrder    Int             @default(0)

  flightNumber    String?
  // MVP: só horário, sem data (ex: "14:00")
  departureTime   String?
  arrivalTime     String?
  embarkAirport   String?
  disembarkAirport String?

  voucher Voucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)

  @@index([voucherId])
  @@index([voucherId, direction, segmentOrder])
}

model Hotel {
  id          String  @id @default(uuid())
  voucherId   String  @unique

  hotelName   String
  mealPlan    String? // Regime de alimentação
  roomType    String? // Tipo apartamento
  checkInTime String? // ex: "14:00"
  checkOutTime String? // ex: "12:00"

  voucher Voucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)
}

model Transfer {
  id            String @id @default(uuid())
  voucherId     String @unique

  receptiveName String? // Nome receptivo

  voucher Voucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)
}
